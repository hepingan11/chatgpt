"use strict";(self["webpackChunkchatgpt"]=self["webpackChunkchatgpt"]||[]).push([[605],{789:function(e,t,n){n.d(t,{Z:function(){return f}});var a=n(3396),l=n(7139);const o={style:{width:"100%"}},i={class:"InputFormFieldWapper"},s={key:1,class:"animation-dot"},u=(0,a.uE)('<div class="dot0" data-v-2aa54a74></div><div class="dot1" data-v-2aa54a74></div><div class="dot2" data-v-2aa54a74></div><div class="dot3" data-v-2aa54a74></div><div class="dot4" data-v-2aa54a74></div>',5),r=[u];function c(e,t,n,u,c,d){const p=(0,a.up)("el-option"),v=(0,a.up)("el-select"),m=(0,a.up)("el-input"),g=(0,a.up)("Promotion"),f=(0,a.up)("el-icon");return(0,a.wg)(),(0,a.iD)("div",o,[(0,a._)("div",i,[e.needSelect?((0,a.wg)(),(0,a.j4)(v,{key:0,modelValue:e.modelInner,"onUpdate:modelValue":t[0]||(t[0]=t=>e.modelInner=t),class:"selectWrapper",placeholder:"Ai模型",onChange:e.updateModel},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{value:"BASIC",label:"智能"}),(0,a.Wm)(p,{value:"ADVANCED",label:"增强"})])),_:1},8,["modelValue","onChange"])):(0,a.kq)("",!0),(0,a.Wm)(m,{style:(0,l.j5)({marginLeft:e.needSelect?"0px":"10px"}),onKeydown:e.handleKeyDown,modelValue:e.inputTextInner,"onUpdate:modelValue":t[1]||(t[1]=t=>e.inputTextInner=t),autosize:"",onInput:e.updateInputText,ref:"inputRefInner",type:"textarea",placeholder:e.aiLoading?"思考中..":"输入你想问的...  ctrl+enter发送",disabled:e.aiLoading},null,8,["style","onKeydown","modelValue","onInput","placeholder","disabled"]),e.aiLoading?((0,a.wg)(),(0,a.iD)("div",s,r)):((0,a.wg)(),(0,a.iD)("div",{key:2,onClick:t[2]||(t[2]=(...t)=>e.onSubmit&&e.onSubmit(...t)),class:"sendIcon"},[(0,a.Wm)(f,{size:20},{default:(0,a.w5)((()=>[(0,a.Wm)(g)])),_:1})]))])])}var d=n(2748),p=n(4870),v=(0,a.aZ)({name:"InputFormField",components:{Promotion:d.Promotion},props:{needSelect:{type:Boolean,default:!0},model:{type:String,default:null},inputText:{type:String,default:null},aiLoading:{type:Boolean,default:!1}},setup(e,{emit:t}){let n=(0,p.iH)(null),l=(0,p.iH)("BASIC");const o=(0,p.iH)(null);function i(){o.value&&o.value.clear()}function s(e){e.ctrlKey&&13===e.keyCode&&t("onSubmit")}function u(){t("onSubmit")}function r(e){l=e,t("update:model",e)}function c(e){n.value=e}return(0,a.YP)((()=>e.model),(e=>{l=e})),(0,a.YP)(n,((e,n)=>{t("update:inputText",e)})),{updateInputText:c,onSubmit:u,handleKeyDown:s,updateModel:r,resetInputValue:i,inputTextInner:n,modelInner:l,inputRefInner:o}}}),m=n(89);const g=(0,m.Z)(v,[["render",c],["__scopeId","data-v-2aa54a74"]]);var f=g},1605:function(e,t,n){n.r(t),n.d(t,{default:function(){return j}});var a=n(3396),l=n(7139),o=n(9242);const i=e=>((0,a.dD)("data-v-18f894b7"),e=e(),(0,a.Cn)(),e),s={class:"body",ref:"scrollRef"},u={key:0,class:"explain"},r={class:"logo"},c={class:"expositoryCase"},d={class:"consume"},p=i((()=>(0,a._)("div",{class:"consumeText"},"每次提问消耗1个SUPER币",-1))),v=i((()=>(0,a._)("div",{class:"beCareful"},"请注意不支持违法、违规等不当信息内容",-1))),m={key:1,class:"questions"},g={class:"question"},f={class:"text"},y={class:"answer"},w={style:{flex:"0"}},h={style:{"font-size":"20px","background-color":"#ddddf8","border-radius":"100%",display:"flex","justify-content":"center","align-items":"center"}},b={style:{width:"28px",height:"28px","text-align":"center",display:"flex","justify-content":"center","align-items":"center"}},x={key:0,style:{flex:"1"}},C={key:0,class:"operation"},I=["onClick"],S=i((()=>(0,a._)("div",{class:"operationExplain"},"复制结果",-1))),k=["onClick"],_=i((()=>(0,a._)("div",{class:"operationExplain"},"收藏",-1))),W={key:1,class:"typing"},D=i((()=>(0,a._)("div",null,"暂停输出",-1))),H={class:"footer"},L={class:"footer-bar"},T={style:{"padding-top":"4px"}},V=i((()=>(0,a._)("div",null,"清理屏幕",-1)));function z(e,t,i,z,F,E){const U=(0,a.up)("Goods"),P=(0,a.up)("el-icon"),R=(0,a.up)("el-avatar"),A=(0,a.up)("v-md-editor"),M=(0,a.up)("CopyDocument"),Z=(0,a.up)("Star"),K=(0,a.up)("VideoPause"),q=(0,a.up)("Clock"),Y=(0,a.up)("InputFormField"),j=(0,a.up)("LoginDialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",s,[z.conversationList.length<=1?((0,a.wg)(),(0,a.iD)("div",u,[(0,a._)("div",r,(0,l.zw)(z.data.icon),1),(0,a._)("div",c,(0,l.zw)(z.data.botInitialization),1),(0,a._)("div",d,[(0,a.Wm)(P,null,{default:(0,a.w5)((()=>[(0,a.Wm)(U)])),_:1}),p]),v])):((0,a.wg)(),(0,a.iD)("div",m,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(z.conversationList,((e,t)=>(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{key:t,class:"item slide-animation"},[(0,a._)("div",g,[(0,a.Wm)(R,{class:"flexShrink",size:28,icon:E.UserFilled,src:E.store.getters.userinfo.avatar?z.imageUrl+E.store.getters.userinfo.avatar:n(2231)},null,8,["icon","src"]),(0,a._)("div",f,(0,l.zw)(e.user),1)]),(0,a._)("div",y,[(0,a._)("div",w,[(0,a._)("div",h,[(0,a._)("div",b,(0,l.zw)(z.data.icon),1)])]),e.assistant?((0,a.wg)(),(0,a.iD)("div",x,[(0,a.Wm)(A,{"model-value":e.assistant,mode:"preview",onCopyCodeSuccess:z.handleCopyCodeSuccess},null,8,["model-value","onCopyCodeSuccess"]),e.isError?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",C,[(0,a._)("div",{onClick:t=>z.copyAnswer(e.assistant),class:"operationItem"},[(0,a.Wm)(P,{size:"14"},{default:(0,a.w5)((()=>[(0,a.Wm)(M)])),_:1}),S],8,I),(0,a.wy)((0,a._)("div",{onClick:n=>z.onCollection(e,t),class:"operationItem operationItemSelected"},[(0,a.Wm)(P,{size:"14"},{default:(0,a.w5)((()=>[(0,a.Wm)(Z),(0,a.Uk)(" "+(0,l.zw)(e.isCollection),1)])),_:2},1024),_],8,k),[[o.F8,!e.isCollection]])]))])):((0,a.wg)(),(0,a.iD)("div",W))])])),[[o.F8,0!==t]]))),128))])),(0,a.wy)((0,a._)("div",{class:"suspend",onClick:t[0]||(t[0]=(...e)=>z.closeSocket&&z.closeSocket(...e))},[(0,a.Wm)(P,{size:16},{default:(0,a.w5)((()=>[(0,a.Wm)(K)])),_:1}),D],512),[[o.F8,z.aiLoading]]),(0,a._)("div",H,[(0,a._)("div",L,[(0,a.wy)((0,a._)("div",{class:"clear",onClick:t[1]||(t[1]=(...e)=>z.clear&&z.clear(...e))},[(0,a._)("div",T,[(0,a.Wm)(P,{size:"13px",style:{"padding-right":"3px"}},{default:(0,a.w5)((()=>[(0,a.Wm)(q)])),_:1})]),V],512),[[o.F8,E.store.getters.userinfo&&!z.aiLoading]]),(0,a.Wm)(Y,{ref:"inputRef",needSelect:!1,aiLoading:z.aiLoading,inputText:z.input,"onUpdate:inputText":t[2]||(t[2]=e=>z.input=e),"onUpdate:model":t[3]||(t[3]=e=>z.model=e),onOnSubmit:z.onSubmit},null,8,["aiLoading","inputText","onOnSubmit"])])])],512),(0,a.Wm)(j,{show:z.loginVisible,onClose:t[4]||(t[4]=e=>z.loginVisible=!1)},null,8,["show"])],64)}n(7658);var F=n(4870),E=n(2748),U=n(6666),P=n(7278),R=n(65),A=n(718),M=n(789),Z=n(4239),K={name:"dialogueView",components:{InputFormField:M.Z,VideoPause:E.VideoPause,CopyDocument:E.CopyDocument,Goods:E.Goods,LoginDialog:A.Z},computed:{store(){return Z.Z},UserFilled(){return E.UserFilled}},setup(){let e=(0,F.iH)(null),t=(0,F.iH)({}),n=(0,R.oR)(),l=(0,F.iH)(null),o=(0,F.iH)(""),i=(0,F.iH)([]),s=(0,F.iH)(!1),u=(0,F.iH)(null),r=(0,F.iH)(!1),c=(0,F.iH)("gpt-3.5-turbo"),d=(0,F.iH)(0);const p=(0,F.iH)(""),v=(0,F.iH)(50),m=(0,F.iH)(10),g=(0,F.iH)(1e3);function f(){u.value&&(u.value.close(),u.value=null),i.value=i.value.slice(0,1)}async function y(){if(!n.getters.userinfo)return s.value=!0;if(""===o.value.trim())return;let t=i.value.length;try{let n=o.value;e.value.resetInputValue(),i.value.push({user:n}),r.value=!0,S();let a=[];i.value.slice(-m.value).forEach((({isError:e,user:t,assistant:n},l,o)=>{if(!e){let e=t,i=n;o.length>2&&l!==o.length-1&&l!==o.length-2&&(e=t.length>g.value?t.slice(0,g.value)+"...":t,i=n&&n.length>g.value?n.slice(0,g.value)+"...":n),a.push({role:"user",content:e}),i&&a.push({role:"assistant",content:i})}})),d.value=t,w({messages:{messages:a},index:t})}catch(a){i.value[t].assistant=a,i.value[t].isError=!0}}function w({messages:e,index:t}){"undefined"==typeof WebSocket?console.log("您的浏览器不支持WebSocket"):(null!=u.value&&(u.value.close(),u.value=null),u.value=new WebSocket("ws://47.109.74.83:8625/gpt-web/api/"+localStorage.getItem("token")+"/"+c.value),u.value.onopen=function(){console.log("websocket已连接"),u.value.send(JSON.stringify(e)),i.value[t].isError=!0},u.value.onmessage=function(e){h.push({msg:e.data,index:t}),x()},u.value.onclose=function(){C(t)},u.value.onerror=function(){(0,U.bM)({title:"信息过期",message:"登录信息已过期,请重新登录",type:"error"}),localStorage.removeItem("token"),localStorage.removeItem("user"),location.reload()})}(0,a.bv)((()=>{n.getters.userinfo&&I(),p.value="https://img-hh.oss-cn-hangzhou.aliyuncs.com",v.value=parseInt("20"),m.value=parseInt("4"),g.value=parseInt("2000");let e=localStorage.getItem("roleData");t.value=JSON.parse(e);const{question:a,answer:l}=t.value.content[0];i.value.push({user:a,assistant:l,isError:!1})}));const h=[];let b=!1;function x(){if(b)return;b=!0;const e=h.shift();if(e){let t=0;function n(){const a=e.index,l=e.msg,o=l.charAt(t++);o?(i.value[a].assistant?i.value[a].assistant+=o:i.value[a].assistant=o,S(),setTimeout(n,v.value)):(b=!1,x())}n()}else b=!1}function C(t){return new Promise((n=>{let l=setInterval((()=>{if(0===h.length){let o=i.value[t].assistant;i.value[t].isError=!1,o||i.value.splice(t,1),I(),r.value=!1,S(),(0,a.Y3)((()=>{e.value.$refs.inputRefInner.focus()})),clearInterval(l),n()}}),50)}))}async function I(){let e=await(0,P.CC)();n.commit("setUserinfo",e)}function S(){setTimeout((()=>{l.value.scrollTop=l.value.scrollHeight}),20)}function k(e){navigator.clipboard.writeText(e),(0,U.bM)({message:"复制成功",type:"success"})}function _(e){navigator.clipboard.writeText(e),(0,U.bM)({message:"复制成功",type:"success"})}function W(){u.value&&(h.length=0,u.value.close(),u.value=null)}async function D(e,t){try{let a=!i.value[t].isCollection;if(a)try{await(0,P.wm)({issue:e.user,answer:e.assistant}),(0,U.bM)({message:"收藏成功",type:"success"})}catch(n){(0,U.bM)({message:n,type:"error"})}i.value[t].isCollection=!0}catch(n){(0,U.bM)({message:n,type:"error"})}}return{clear:f,inputRef:e,model:c,onSubmit:y,input:o,conversationList:i,scrollRef:l,handleCopyCodeSuccess:k,loginVisible:s,onCollection:D,copyAnswer:_,aiLoading:r,closeSocket:W,dataIndex:d,imageUrl:p,data:t}}},q=n(89);const Y=(0,q.Z)(K,[["render",z],["__scopeId","data-v-18f894b7"]]);var j=Y},2231:function(e,t,n){e.exports=n.p+"assets/img/my.5065d1f5.png"}}]);