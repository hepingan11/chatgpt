"use strict";(self["webpackChunkchatgpt"]=self["webpackChunkchatgpt"]||[]).push([[430],{7220:function(e,a,t){function l(e){const a=6e4,t=60*a,l=24*t,i=7*l,n=30*l,o=(new Date).getTime(),s=o-e;if(s<0)return;let u;return u=s<=a?"刚刚":s<=t?Math.floor(s/a)+"分钟前":s<=l?Math.floor(s/t)+"小时前":s<=i?Math.floor(s/l)+"天前":s<=n?Math.floor(s/i)+"周前":s<=12*n?Math.floor(s/n)+"月前":Math.floor(s/(12*n))+"年前",u}t.d(a,{Z:function(){return l}})},789:function(e,a,t){t.d(a,{Z:function(){return f}});var l=t(3396),i=t(7139);const n={style:{width:"100%"}},o={class:"InputFormFieldWapper"},s={key:1,class:"animation-dot"},u=(0,l.uE)('<div class="dot0" data-v-2aa54a74></div><div class="dot1" data-v-2aa54a74></div><div class="dot2" data-v-2aa54a74></div><div class="dot3" data-v-2aa54a74></div><div class="dot4" data-v-2aa54a74></div>',5),c=[u];function d(e,a,t,u,d,r){const v=(0,l.up)("el-option"),p=(0,l.up)("el-select"),g=(0,l.up)("el-input"),m=(0,l.up)("Promotion"),f=(0,l.up)("el-icon");return(0,l.wg)(),(0,l.iD)("div",n,[(0,l._)("div",o,[e.needSelect?((0,l.wg)(),(0,l.j4)(p,{key:0,modelValue:e.modelInner,"onUpdate:modelValue":a[0]||(a[0]=a=>e.modelInner=a),class:"selectWrapper",placeholder:"Ai模型",onChange:e.updateModel},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{value:"BASIC",label:"智能"}),(0,l.Wm)(v,{value:"ADVANCED",label:"增强"})])),_:1},8,["modelValue","onChange"])):(0,l.kq)("",!0),(0,l.Wm)(g,{style:(0,i.j5)({marginLeft:e.needSelect?"0px":"10px"}),onKeydown:e.handleKeyDown,modelValue:e.inputTextInner,"onUpdate:modelValue":a[1]||(a[1]=a=>e.inputTextInner=a),autosize:"",onInput:e.updateInputText,ref:"inputRefInner",type:"textarea",placeholder:e.aiLoading?"思考中..":"输入你想问的...  ctrl+enter发送",disabled:e.aiLoading},null,8,["style","onKeydown","modelValue","onInput","placeholder","disabled"]),e.aiLoading?((0,l.wg)(),(0,l.iD)("div",s,c)):((0,l.wg)(),(0,l.iD)("div",{key:2,onClick:a[2]||(a[2]=(...a)=>e.onSubmit&&e.onSubmit(...a)),class:"sendIcon"},[(0,l.Wm)(f,{size:20},{default:(0,l.w5)((()=>[(0,l.Wm)(m)])),_:1})]))])])}var r=t(2748),v=t(4870),p=(0,l.aZ)({name:"InputFormField",components:{Promotion:r.Promotion},props:{needSelect:{type:Boolean,default:!0},model:{type:String,default:null},inputText:{type:String,default:null},aiLoading:{type:Boolean,default:!1}},setup(e,{emit:a}){let t=(0,v.iH)(null),i=(0,v.iH)("BASIC");const n=(0,v.iH)(null);function o(){n.value&&n.value.clear()}function s(e){e.ctrlKey&&13===e.keyCode&&a("onSubmit")}function u(){a("onSubmit")}function c(e){i=e,a("update:model",e)}function d(e){t.value=e}return(0,l.YP)((()=>e.model),(e=>{i=e})),(0,l.YP)(t,((e,t)=>{a("update:inputText",e)})),{updateInputText:d,onSubmit:u,handleKeyDown:s,updateModel:c,resetInputValue:o,inputTextInner:t,modelInner:i,inputRefInner:n}}}),g=t(89);const m=(0,g.Z)(p,[["render",d],["__scopeId","data-v-2aa54a74"]]);var f=m},7430:function(e,a,t){t.r(a),t.d(a,{default:function(){return ce}});var l=t(3396),i=t(7139),n=t(9242),o=t(5880);const s=e=>((0,l.dD)("data-v-0e46b4ae"),e=e(),(0,l.Cn)(),e),u={class:"body",ref:"scrollRef"},c={key:0,class:"explain"},d=s((()=>(0,l._)("img",{class:"logo",alt:"Vue logo",src:o},null,-1))),r=s((()=>(0,l._)("div",{class:"expositoryCase"},"欢迎使用TIME SEA PLUS",-1))),v={class:"consume"},p=s((()=>(0,l._)("div",{class:"consumeText"},"每次提问消耗1个SUPER币",-1))),g=s((()=>(0,l._)("div",{class:"beCareful"},"请注意不支持违法、违规等不当信息内容",-1))),m={key:1,class:"questions",style:{margin:"20px 0"}},f={class:"question"},h={class:"text"},y={class:"operation--model_user"},w=["onClick"],x=s((()=>(0,l._)("text",{class:"op-font"},"复制",-1))),C={class:"answer"},_={key:0,style:{width:"100%"}},S={key:0,class:"operation--model"},b=["onClick"],k=s((()=>(0,l._)("text",{class:"op-font"},"复制",-1))),I=["onClick"],W=s((()=>(0,l._)("text",{class:"op-font"},"收藏",-1))),D={key:1,class:"answer-data",style:{width:"100px"}},H=(0,l.uE)('<div style="display:flex;padding:5px 9px;" data-v-0e46b4ae><div class="dot_0" data-v-0e46b4ae></div><div class="dot_1" data-v-0e46b4ae></div><div class="dot_2" data-v-0e46b4ae></div><div class="dot_3" data-v-0e46b4ae></div><div class="dot_4" data-v-0e46b4ae></div></div>',1),L=[H],V=s((()=>(0,l._)("div",null,"暂停输出",-1))),T={class:"footer"},F={class:"footer-bar"},M={style:{"padding-top":"4px"}},E=s((()=>(0,l._)("div",null,"清除聊天",-1))),U={style:{"padding-top":"4px"}},z=s((()=>(0,l._)("div",null,"记忆回溯",-1))),A=s((()=>(0,l._)("div",{class:"cache-flex-center"},[(0,l._)("img",{alt:"Vue logo",src:o,class:"cache-img"})],-1))),P=s((()=>(0,l._)("div",{class:"cache-text"},"TIME SEA PLUS",-1))),R={class:"cache-flex-center cache-padding-top"},N=s((()=>(0,l._)("div",{class:"cache-btn-text"},"创建新的聊天",-1))),K={class:"cache-content"},O={class:"cache-scrollbar"},Z={class:"cache-flex-space-between"},q=["onClick"],J={class:"cache-message-text"},Y={class:"cache-message-time"},B={class:"cache-selected"},j=["src","onClick"];function G(e,a,o,s,H,G){const $=(0,l.up)("Goods"),Q=(0,l.up)("el-icon"),X=(0,l.up)("CopyDocument"),ee=(0,l.up)("el-avatar"),ae=(0,l.up)("v-md-editor"),te=(0,l.up)("StarFilled"),le=(0,l.up)("VideoPause"),ie=(0,l.up)("Clock"),ne=(0,l.up)("ChatDotRound"),oe=(0,l.up)("InputFormField"),se=(0,l.up)("ChatLineSquare"),ue=(0,l.up)("el-scrollbar"),ce=(0,l.up)("el-dialog"),de=(0,l.up)("LoginDialog");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",u,[s.conversationList.length?((0,l.wg)(),(0,l.iD)("div",m,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.conversationList,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a,class:"item slide-animation"},[(0,l._)("div",f,[(0,l._)("div",null,[(0,l._)("div",h,(0,i.zw)(e.user),1),(0,l._)("div",y,[(0,l._)("div",{class:"op-btn",onClick:a=>s.copyAnswer(e.user)},[(0,l.Wm)(Q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(X)])),_:1}),x],8,w)])]),(0,l.Wm)(ee,{class:"flexShrink",size:35,icon:G.UserFilled,src:G.store.getters.userinfo.avatar?s.imageUrl+G.store.getters.userinfo.avatar:t(2231)},null,8,["icon","src"])]),(0,l._)("div",C,[(0,l.Wm)(ee,{class:"flexShrink",size:35,icon:G.UserFilled,src:t(6899)},null,8,["icon","src"]),e.assistant?((0,l.wg)(),(0,l.iD)("div",_,[(0,l._)("div",{class:"answer-data",style:(0,i.j5)({maxWidth:s.calculateWidth(e.assistant.length)})},[(0,l.Wm)(ae,{"model-value":e.assistant,mode:"preview",onCopyCodeSuccess:s.handleCopyCodeSuccess},null,8,["model-value","onCopyCodeSuccess"])],4),e.isError?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",S,[(0,l._)("div",{class:"op-btn",onClick:a=>s.copyAnswer(e.assistant)},[(0,l.Wm)(Q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(X)])),_:1}),k],8,b),e.isCollection?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",{key:0,class:"op-btn",onClick:t=>s.onCollection(e,a)},[(0,l.Wm)(Q,{color:"rgb(255,236,160)"},{default:(0,l.w5)((()=>[(0,l.Wm)(te)])),_:1}),W],8,I))]))])):((0,l.wg)(),(0,l.iD)("div",D,L))])])))),128))])):((0,l.wg)(),(0,l.iD)("div",c,[d,r,(0,l._)("div",v,[(0,l.Wm)(Q,null,{default:(0,l.w5)((()=>[(0,l.Wm)($)])),_:1}),p]),g])),(0,l.wy)((0,l._)("div",{class:"suspend",onClick:a[0]||(a[0]=(...e)=>s.closeSocket&&s.closeSocket(...e))},[(0,l.Wm)(Q,{size:16},{default:(0,l.w5)((()=>[(0,l.Wm)(le)])),_:1}),V],512),[[n.F8,s.aiLoading]]),(0,l._)("div",T,[(0,l._)("div",F,[(0,l.wy)((0,l._)("div",{class:"clear",onClick:a[1]||(a[1]=(...e)=>s.clear&&s.clear(...e))},[(0,l._)("div",M,[(0,l.Wm)(Q,{size:"13px",style:{"padding-right":"3px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(ie)])),_:1})]),E],512),[[n.F8,G.store.getters.userinfo&&!s.aiLoading]]),(0,l.wy)((0,l._)("div",{class:"clear2",onClick:a[2]||(a[2]=e=>s.dialogueDisplay=!0)},[(0,l._)("div",U,[(0,l.Wm)(Q,{size:"13px",style:{"padding-right":"3px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(ne)])),_:1})]),z],512),[[n.F8,G.store.getters.userinfo&&!s.aiLoading]]),(0,l.Wm)(oe,{ref:"inputRef",aiLoading:s.aiLoading,inputText:s.input,"onUpdate:inputText":a[3]||(a[3]=e=>s.input=e),"onUpdate:model":a[4]||(a[4]=e=>s.model=e),onOnSubmit:s.onSubmit},null,8,["aiLoading","inputText","onOnSubmit"])])])],512),(0,l.Wm)(ce,{modelValue:s.dialogueDisplay,"onUpdate:modelValue":a[6]||(a[6]=e=>s.dialogueDisplay=e),title:"",width:"430px",center:"",style:{"background-color":"var(--bgColor1)"}},{default:(0,l.w5)((()=>[(0,l._)("div",null,[A,P,(0,l._)("div",R,[(0,l._)("div",{class:"cache-btn",onClick:a[5]||(a[5]=(...e)=>s.createdNewChat&&s.createdNewChat(...e))},[(0,l.Wm)(Q,{size:"16px"},{default:(0,l.w5)((()=>[(0,l.Wm)(se)])),_:1}),N])]),(0,l._)("div",K,[(0,l._)("div",O,[(0,l.Wm)(ue,{height:"250px"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.dialogueCache.array,((e,a)=>((0,l.wg)(),(0,l.iD)("div",{class:"cache-padding",key:a},[(0,l._)("div",Z,[(0,l._)("div",{class:"cache-message",onClick:e=>s.switchChat(a)},[(0,l._)("div",J,(0,i.zw)(e.title),1),(0,l._)("div",Y,(0,i.zw)(G.conversionTime(e.time)),1)],8,q),(0,l._)("div",B,[(0,l._)("img",{src:s.dialogueCache.index===a?t(8386):t(5860),class:"cache-selected-img",onClick:e=>s.clearDialogue(a)},null,8,j)])])])))),128))])),_:1})])])])])),_:1},8,["modelValue"]),(0,l.Wm)(de,{show:s.loginVisible,onClose:a[7]||(a[7]=e=>s.loginVisible=!1)},null,8,["show"])],64)}t(541),t(7658);var $=t(4870),Q=t(2748),X=t(6666),ee=t(7278),ae=t(65),te=t(718),le=t(789),ie=t(4239),ne=t(7220),oe={name:"dialogueView",methods:{conversionTime:ne.Z},components:{StarFilled:Q.StarFilled,CopyDocument:Q.CopyDocument,InputFormField:le.Z,ChatDotRound:Q.ChatDotRound,ChatLineSquare:Q.ChatLineSquare,Clock:Q.Clock,VideoPause:Q.VideoPause,Goods:Q.Goods,LoginDialog:te.Z},computed:{store(){return ie.Z},UserFilled(){return Q.UserFilled}},setup(){let e=(0,$.iH)(100),a=(0,$.iH)(740),t=(0,$.iH)(null),i=(0,ae.oR)(),n=(0,$.iH)(null),o=(0,$.iH)(""),s=(0,$.iH)([]),u=(0,$.iH)(!1),c=(0,$.iH)(null),d=(0,$.iH)(!1),r=(0,$.iH)("BASIC");const v=(0,$.iH)("");let p=(0,$.iH)(!1);const g=(0,$.iH)({}),m=(0,$.iH)("30%"),f=(0,$.iH)(50),h=(0,$.iH)(10),y=(0,$.iH)(1e3);function w(e){e.ctrlKey&&13===e.keyCode&&(console.log("Alt + Enter 被按下"),I())}function x(){window.innerWidth<=768?m.value="70%":m.value="30%"}function C(e){g.value.index=e,s.value=g.value.array[e].context,localStorage.setItem("dialogueCache",JSON.stringify(g.value)),p.value=!1}function _(t){let l=e.value+16*t;return l>=a.value&&(l=a.value),`${l}px`}function S(e){if(e!==g.value.index){let a=parseInt(g.value.index);e<a&&(g.value.index=a-1),g.value.array.splice(e,1)}localStorage.setItem("dialogueCache",JSON.stringify(g.value))}function b(){let e=s.value,a=g.value;g.value.array[a.index].time=Date.now(),e.length>0&&(g.value.array[a.index].title=e[e.length-1].user.trim().slice(0,25)),g.value.array[a.index].context=e,localStorage.setItem("dialogueCache",JSON.stringify(g.value))}function k(){g.value.array.unshift({title:"新对话",time:Date.now(),context:[]}),g.value.index=0,s.value=[],localStorage.setItem("dialogueCache",JSON.stringify(g.value))}async function I(){if(!i.getters.userinfo)return void(u.value=!0);if(console.log("父的提交，onSubmit()->input",o),console.log("父的提交，onSubmit()->input.value",o.value),""===o.value.trim())return;let e=s.value.length,a=o.value;t.value.resetInputValue(),s.value.push({user:a}),d.value=!0,F();let l=[];s.value.slice(-h.value).forEach((({isError:e,user:a,assistant:t},i,n)=>{if(!e){let e=a,o=t;n.length>2&&i!==n.length-1&&i!==n.length-2&&(e=a.length>y.value?a.slice(0,y.value)+"...":a,o=t&&t.length>y.value?t.slice(0,y.value)+"...":t),l.push({role:"user",content:e}),o&&l.push({role:"assistant",content:o})}})),W({messages:{messages:l},index:e})}function W({messages:e,index:a}){"undefined"==typeof WebSocket?console.log("您的浏览器不支持WebSocket"):(null!=c.value&&(c.value.close(),c.value=null),console.log("发起websocket",r.value),c.value=new WebSocket("ws://47.109.74.83:8625/gpt-web/api/"+localStorage.getItem("token")+"/"+r.value),c.value.onopen=function(){c.value.send(JSON.stringify(e)),s.value[a].isError=!0},c.value.onmessage=function(e){D.push({msg:e.data,index:a}),L()},c.value.onclose=function(){V(a)},c.value.onerror=function(){(0,X.bM)({title:"信息过期",message:"登录信息已过期,请重新登录",type:"error"}),localStorage.removeItem("token"),localStorage.removeItem("user"),location.reload()})}(0,l.bv)((()=>{window.addEventListener("resize",x),x(),i.getters.userinfo&&T(),v.value="https://img-hh.oss-cn-hangzhou.aliyuncs.com",f.value=parseInt("20"),h.value=parseInt("4"),y.value=parseInt("2000");let e=localStorage.getItem("dialogueCache");if(i.getters.userinfo){if(!i.getters.userinfo)return u.value=!0;if(e){g.value=JSON.parse(e);let a=g.value;s.value=a.array[a.index].context,F()}else g.value={index:0,array:[{title:"新对话",time:Date.now(),context:s.value}]},localStorage.setItem("dialogueCache",JSON.stringify(g.value))}}));const D=[];let H=!1;function L(){if(H)return;H=!0;const e=D.shift();if(e){let a=0;function t(){const l=e.index,i=e.msg,n=i.charAt(a++);n?(s.value[l].assistant?s.value[l].assistant+=n:s.value[l].assistant=n,F(),setTimeout(t,f.value)):(H=!1,L())}t()}else H=!1}function V(e){return new Promise((a=>{let i=setInterval((()=>{if(0===D.length){let n=s.value[e].assistant;s.value[e].isError=!1,n||s.value.splice(e,1),b(),T(),d.value=!1,F(),(0,l.Y3)((()=>{t.value.$refs.inputRefInner.focus()})),clearInterval(i),a()}}),50)}))}async function T(){let e=await(0,ee.CC)();i.commit("setUserinfo",e)}function F(){(0,l.Y3)((()=>{n.value.scrollTop=n.value.scrollHeight}))}function M(e){navigator.clipboard.writeText(e),(0,X.bM)({message:"复制成功",type:"success"})}function E(e){navigator.clipboard.writeText(e),(0,X.bM)({message:"复制成功",type:"success"})}function U(){c.value&&(D.length=0,c.value.close(),c.value=null)}function z(){U(),s.value=[],b()}async function A(e,a){try{let l=!s.value[a].isCollection;if(l)try{await(0,ee.wm)({issue:e.user,answer:e.assistant}),(0,X.bM)({message:"收藏成功",type:"success"})}catch(t){(0,X.bM)({message:t,type:"error"})}s.value[a].isCollection=!0}catch(t){(0,X.bM)({message:t,type:"error"})}}return{handleKeyDown:w,inputRef:t,model:r,onSubmit:I,input:o,clear:z,conversationList:s,scrollRef:n,handleCopyCodeSuccess:M,loginVisible:u,onCollection:A,copyAnswer:E,aiLoading:d,closeSocket:U,imageUrl:v,dialogueDisplay:p,dialogueCache:g,createdNewChat:k,switchChat:C,clearDialogue:S,dialogueWidth:m,calculateWidth:_,initialWidth:e,maxWidth:a}}},se=t(89);const ue=(0,se.Z)(oe,[["render",G],["__scopeId","data-v-0e46b4ae"]]);var ce=ue},5860:function(e,a,t){e.exports=t.p+"assets/img/close.5a0f034d.svg"},5880:function(e,a,t){e.exports=t.p+"assets/img/logo02.a683f10f.svg"},8386:function(e,a,t){e.exports=t.p+"assets/img/selected.c73db6e6.svg"},2231:function(e,a,t){e.exports=t.p+"assets/img/my.5065d1f5.png"}}]);